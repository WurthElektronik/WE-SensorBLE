"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3616],{3616:($,y,d)=>{d.r(y),d.d(y,{FeatherWingTabModule:()=>Q,createTranslateLoader:()=>C});var a=d(5056),f=d(6895),m=d(4006),x=d(529),p=d(3652),F=d(9832),T=d(3196),c=d(5861),e=d(6738);let N=(()=>{class i{constructor(t,n,o){this.modalCtrl=t,this.toastController=n,this.translateService=o}ngOnInit(){}cancel(){return this.modalCtrl.dismiss(null,"cancel")}edit(){var t=this;return(0,c.Z)(function*(){if(t.updaterate>=t.minupdateinterval&&Number.isInteger(t.updaterate))return t.modalCtrl.dismiss(t.updaterate,"confirm");t.translateService.get("EditUpdateRate.invalidupdaterate",{mininterval:t.minupdateinterval}).subscribe(function(){var n=(0,c.Z)(function*(o){try{t.toastController.dismiss().then(()=>{}).catch(()=>{}).finally(()=>{})}catch{}(yield t.toastController.create({message:o,duration:500,position:"middle",cssClass:"toastwidth"})).present()});return function(o){return n.apply(this,arguments)}}())})()}validateNo(t){const n=t.which?t.which:t.keyCode;return!(n>31&&(n<48||n>57))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(a.IN),e.Y36(a.yF),e.Y36(p.sK))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-edit-update-rate"]],decls:16,vars:14,consts:[[1,"inner-content"],["type","number","clearInput","","step","1",3,"ngModel","placeholder","min","ngModelChange","keypress"],[1,"ion-text-center","ion-align-items-center"],[3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h1"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-input",1),e.NdJ("ngModelChange",function(r){return n.updaterate=r})("keypress",function(r){return n.validateNo(r)}),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"ion-grid")(7,"ion-row",2)(8,"ion-col")(9,"ion-button",3),e.NdJ("click",function(){return n.cancel()}),e._uU(10),e.ALo(11,"translate"),e.qZA()(),e.TgZ(12,"ion-col")(13,"ion-button",3),e.NdJ("click",function(){return n.edit()}),e._uU(14),e.ALo(15,"translate"),e.qZA()()()()()),2&t&&(e.xp6(2),e.Oqu(e.lcZ(3,6,"EditUpdateRate.header")),e.xp6(2),e.s9C("placeholder",e.lcZ(5,8,"EditUpdateRate.updaterateplaceholder")),e.Q6J("ngModel",n.updaterate)("min",n.minupdateinterval),e.xp6(6),e.Oqu(e.lcZ(11,10,"EditUpdateRate.cancel")),e.xp6(4),e.Oqu(e.lcZ(15,12,"EditUpdateRate.edit")))},dependencies:[a.YG,a.wI,a.jY,a.pK,a.Nd,a.as,m.JJ,m.On,p.X$],styles:["ion-input[_ngcontent-%COMP%]{caret-color:var(--ion-color-primary)}ion-button[_ngcontent-%COMP%]{width:100%}"]}),i})();var h=d(6748),w=d(1946),Z=d(9892);let W=(()=>{class i{constructor(t){this.modalCtrl=t,this.thresholds=Object.keys(h.a).map(n=>h.a[n]).filter(n=>"string"==typeof n),this.selectedThresholdType=h.a.LowerThreshold}ngOnInit(){}cancel(){return this.modalCtrl.dismiss(null,"cancel")}setThreshold(){var t=this;return(0,c.Z)(function*(){return t.modalCtrl.dismiss({thresholdType:t.selectedThresholdType,thresholdValue:t.threshold},"confirm")})()}validateNo(t){const n=t.which?t.which:t.keyCode;return!(n>31&&46!=n&&(n<48||n>57))}thresholdTypeChanged(t){this.selectedThresholdType=h.a[t.detail.value]}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(a.IN))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-add-threshold"]],decls:23,vars:20,consts:[[1,"inner-content"],["interface","action-sheet",3,"value","ionChange"],["value","LowerThreshold"],["value","UpperThreshold"],["type","number","clearInput","","step","1",3,"ngModel","placeholder","ngModelChange","keypress"],[1,"ion-text-center","ion-align-items-center"],[3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h1"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-select",1),e.NdJ("ionChange",function(r){return n.thresholdTypeChanged(r)}),e.TgZ(5,"ion-select-option",2),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"ion-select-option",3),e._uU(9),e.ALo(10,"translate"),e.qZA()(),e.TgZ(11,"ion-input",4),e.NdJ("ngModelChange",function(r){return n.threshold=r})("keypress",function(r){return n.validateNo(r)}),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"ion-grid")(14,"ion-row",5)(15,"ion-col")(16,"ion-button",6),e.NdJ("click",function(){return n.cancel()}),e._uU(17),e.ALo(18,"translate"),e.qZA()(),e.TgZ(19,"ion-col")(20,"ion-button",6),e.NdJ("click",function(){return n.setThreshold()}),e._uU(21),e.ALo(22,"translate"),e.qZA()()()()()),2&t&&(e.xp6(2),e.Oqu(e.lcZ(3,8,"AddThreshold.header")),e.xp6(2),e.s9C("value",n.thresholds[n.selectedThresholdType]),e.xp6(2),e.Oqu(e.lcZ(7,10,"FeatherWingTab.ThresholdTypes.LowerThreshold")),e.xp6(3),e.Oqu(e.lcZ(10,12,"FeatherWingTab.ThresholdTypes.UpperThreshold")),e.xp6(2),e.s9C("placeholder",e.lcZ(12,14,"AddThreshold.thresholdplaceholder")),e.Q6J("ngModel",n.threshold),e.xp6(6),e.Oqu(e.lcZ(18,16,"AddThreshold.cancel")),e.xp6(4),e.Oqu(e.lcZ(22,18,"AddThreshold.add")))},dependencies:[a.YG,a.wI,a.jY,a.pK,a.Nd,a.t9,a.n0,a.as,a.QI,m.JJ,m.On,p.X$],styles:["ion-input[_ngcontent-%COMP%]{caret-color:var(--ion-color-primary)}ion-button[_ngcontent-%COMP%]{width:100%}"]}),i})();var k=d(9318);function U(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",3),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.showmodel(o))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"FeatherWingTab.showmodel")," "))}function M(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",6)(1,"ion-label",14),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-button",3),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.editinterval(o))}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(2),e.AsE(" ",e.lcZ(3,3,"FeatherWingTab.sensorupdateinterval")," : ",t.getUpdateInterval()/1e3," s "),e.xp6(3),e.hij(" ",e.lcZ(6,5,"FeatherWingTab.editupdateinterval")," ")}}function J(i,s){1&i&&e._UZ(0,"ion-icon",12)}function O(i,s){if(1&i&&e._UZ(0,"ion-label",21),2&i){const t=e.oxw().$implicit;e.Q6J("innerText",t.value.getCurrentAttributeString())}}function E(i,s){if(1&i&&(e.TgZ(0,"ion-radio-group",22),e._UZ(1,"ion-radio",23),e.qZA()),2&i){const t=e.oxw().$implicit;e.Q6J("value",t.value.getCurrentValue().getData()),e.xp6(1),e.Q6J("value",!0)}}function I(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ion-chip")(1,"ion-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-icon",27),e.NdJ("click",function(){const r=e.CHM(t).$implicit,l=e.oxw(2).$implicit;return e.KtG(l.value.removeThreshold(r.key))}),e.qZA()()}if(2&i){const t=s.$implicit,n=e.oxw(2).$implicit,o=e.oxw(2);e.xp6(2),e.AsE(" ",e.lcZ(3,2,"FeatherWingTab.ThresholdTypes."+o.ThresholdType[t.key])," ",n.value.getAttributeValueString(t.value)," ")}}function q(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ion-row",24)(1,"ion-label",25),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,I,5,4,"ion-chip",5),e.ALo(5,"keyvalue"),e.TgZ(6,"ion-icon",26),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.addThreshold(o.value))}),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(2),e.hij("",e.lcZ(3,2,"FeatherWingTab.thresholds"),":"),e.xp6(2),e.Q6J("ngForOf",e.lcZ(5,4,t.value.getThresholds()))}}function Y(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",15)(1,"ion-grid")(2,"ion-row",16),e.NdJ("click",function(){const r=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(l.attributeclick(r.value))}),e.TgZ(3,"ion-label")(4,"span",11),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.YNc(7,J,1,0,"ion-icon",17),e.qZA(),e.YNc(8,O,1,1,"ion-label",18),e.YNc(9,E,2,2,"ion-radio-group",19),e.qZA(),e.YNc(10,q,7,6,"ion-row",20),e.qZA()()}if(2&i){const t=s.$implicit;e.xp6(5),e.Oqu(e.lcZ(6,5,"SensorAttributes."+t.value.getAttributeName())),e.xp6(2),e.Q6J("ngIf",0==t.value.isEvent()),e.xp6(1),e.Q6J("ngIf",0==t.value.isEvent()),e.xp6(1),e.Q6J("ngIf",1==t.value.isEvent()),e.xp6(1),e.Q6J("ngIf",0==t.value.isEvent())}}function L(i,s){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"ion-list-header")(2,"div",6)(3,"ion-label",7),e._uU(4),e.qZA(),e.YNc(5,U,3,3,"ion-button",8),e.qZA(),e.YNc(6,M,7,7,"div",9),e.TgZ(7,"div",10),e.NdJ("click",function(){const r=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.allattributesclick(r))}),e.TgZ(8,"ion-label")(9,"span",11),e._uU(10),e.ALo(11,"translate"),e.qZA(),e._UZ(12,"ion-icon",12),e.qZA()()(),e.YNc(13,Y,11,7,"ion-item",13),e.ALo(14,"keyvalue"),e.BQk()}if(2&i){const t=s.$implicit;e.xp6(4),e.hij(" ",t.getSensorName()," "),e.xp6(1),e.Q6J("ngIf",t.getModel),e.xp6(1),e.Q6J("ngIf",null!=t.getUpdateInterval()),e.xp6(4),e.Oqu(e.lcZ(11,5,"FeatherWingTab.graphallattributes")),e.xp6(3),e.Q6J("ngForOf",e.lcZ(14,7,t.getAttributes()))}}const P=[{path:"",component:(()=>{class i{constructor(t,n,o,r,l,u,g,_,b){this.route=t,this.platform=n,this.router=o,this.ble=r,this.ngZone=l,this.modalCtrl=u,this.loadingCtrl=g,this.toastController=_,this.translateService=b,this.id=null,this.ThresholdType=h.a}ngOnInit(){var t=this;return(0,c.Z)(function*(){t.route.queryParamMap.subscribe(function(){var n=(0,c.Z)(function*(o){if(!t.ble.isconnected())try{t.id=o.get("deviceid"),yield t.ble.connect(t.id),yield t.ble.starttxnotifications(t.id),t.disconnectsubscription=t.ble.onDeviceDisconnected.subscribe((0,c.Z)(function*(){(yield t.loadingCtrl.getTop())&&t.loadingCtrl.dismiss(),t.disconnectsubscription&&t.disconnectsubscription.unsubscribe(),t.translateService.get("FeatherWingTab.devicedisconnected").subscribe(function(){var l=(0,c.Z)(function*(u){(yield t.toastController.create({message:u,duration:500,position:"middle",cssClass:"toastwidth"})).present()});return function(u){return l.apply(this,arguments)}}()),t.router.navigate(["/tabs/scan"])}))}catch{(yield t.loadingCtrl.getTop())&&t.loadingCtrl.dismiss(),t.disconnectsubscription&&t.disconnectsubscription.unsubscribe(),t.translateService.get("FeatherWingTab.devicedisconnected").subscribe(function(){var u=(0,c.Z)(function*(g){(yield t.toastController.create({message:g,duration:500,position:"middle",cssClass:"toastwidth"})).present()});return function(g){return u.apply(this,arguments)}}()),t.router.navigate(["/tabs/scan"])}});return function(o){return n.apply(this,arguments)}}())})()}ionViewWillEnter(){var t=this;this.attrssubscriptions=[],this.attrssubscriptions.push(this.ble.onDataReceived.subscribe((0,c.Z)(function*(){(yield t.loadingCtrl.getTop())&&t.loadingCtrl.dismiss(),t.ngZone.run(()=>{})}))),this.attrssubscriptions.push(this.ble.onSensorAdded.subscribe(function(){var n=(0,c.Z)(function*(o){o.getAttributes().forEach(r=>{t.attrssubscriptions.push(r.onThresholdExceeded.subscribe(function(){var l=(0,c.Z)(function*(u){t.translateService.get(["SensorAttributes."+r.getAttributeName(),"FeatherWingTab.ThresholdTypes."+h.a[u]]).subscribe(function(){var g=(0,c.Z)(function*(_){t.translateService.get(["Notifications.ThresholdExceeded","Notifications.ThresholdInfo"],{attributeName:_["SensorAttributes."+r.getAttributeName()],sensorName:r.getParentsensor().getSensorName(),thresholdType:_["FeatherWingTab.ThresholdTypes."+h.a[u]]}).subscribe(function(){var b=(0,c.Z)(function*(v){let A=100*r.getParentsensor().getType()+10*r.getAttributeType()+u;null==(yield Z.s.getDeliveredNotifications()).notifications.find(R=>R.id==A)&&Z.s.schedule({notifications:[{title:v["Notifications.ThresholdExceeded"],body:v["Notifications.ThresholdInfo"],id:A}]})});return function(v){return b.apply(this,arguments)}}())});return function(_){return g.apply(this,arguments)}}())});return function(u){return l.apply(this,arguments)}}())),r.isEvent()&&t.attrssubscriptions.push(r.onDataReceived.subscribe(()=>{t.ngZone.run(()=>{})}))})});return function(o){return n.apply(this,arguments)}}()))}ionViewWillLeave(){this.attrssubscriptions.forEach(t=>{t&&t.unsubscribe()}),this.attrssubscriptions=[]}disconnectclick(){var t=this;return(0,c.Z)(function*(){t.ble.disconnect(t.id),t.router.navigate(["/tabs/scan"])})()}attributeclick(t){t.isEvent()||this.router.navigate(["/tabs/attributegraph"],{queryParams:{sensortype:t.getParentsensor().getType(),attributetypes:JSON.stringify([t.getAttributeType()])}})}allattributesclick(t){var n=Array.from(t.getAttributes().values());if(0==(n=n.filter(r=>0==r.isEvent())).length)return;let o=n.map(r=>r.getAttributeType());this.router.navigate(["/tabs/attributegraph"],{queryParams:{sensortype:t.getType(),attributetypes:JSON.stringify(o)}})}editinterval(t){var n=this;return(0,c.Z)(function*(){const o=yield n.modalCtrl.create({component:N,componentProps:{updaterate:t.getUpdateInterval(),minupdateinterval:t.getMinUpdateInterval()}});o.cssClass="auto-height",o.animated=!1,o.present();const{data:r,role:l}=yield o.onWillDismiss();"confirm"===l&&(t.setUpdateInterval(r),n.ble.senddata(n.id,t.formupdateratepacket()))})()}showmodel(t){this.router.navigate(["/tabs/sensormodel"],{queryParams:{sensortype:t.getType()}})}addThreshold(t){var n=this;return(0,c.Z)(function*(){const o=yield n.modalCtrl.create({component:W});o.cssClass="auto-height",o.animated=!1,o.present();const{data:r,role:l}=yield o.onWillDismiss();"confirm"===l&&t.setThreshold(r.thresholdType,new w.g(0,r.thresholdValue))})()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T.gz),e.Y36(a.t4),e.Y36(T.F0),e.Y36(k.x),e.Y36(e.R0b),e.Y36(a.IN),e.Y36(a.HT),e.Y36(a.yF),e.Y36(p.sK))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-featherwing"]],decls:10,vars:2,consts:[[3,"translucent"],["color","primary"],["slot","end"],[3,"click"],["slot","icon-only","name","close-outline"],[4,"ngFor","ngForOf"],[1,"seperateitems"],[1,"sensorname"],[3,"click",4,"ngIf"],["class","seperateitems",4,"ngIf"],[1,"ion-margin-start","seperateitems",2,"padding","5px",3,"click"],[1,"attrname"],["name","chevron-forward-outline",1,"attrgraphicon"],["class","ion-margin-start no-ripple",4,"ngFor","ngForOf"],["color","medium",1,"updateintervalabel"],[1,"ion-margin-start","no-ripple"],[1,"ion-align-items-center","ion-justify-content-between",3,"click"],["class","attrgraphicon","name","chevron-forward-outline",4,"ngIf"],["class","ion-text-center",3,"innerText",4,"ngIf"],["style","pointer-events: none;",3,"value",4,"ngIf"],["class","ion-text-center ion-align-items-center","style","min-height: 42px;",4,"ngIf"],[1,"ion-text-center",3,"innerText"],[2,"pointer-events","none",3,"value"],[3,"value"],[1,"ion-text-center","ion-align-items-center",2,"min-height","42px"],["color","medium"],["color","primary","size","large","name","add-circle",3,"click"],["name","close","size","small",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2)(3,"ion-button",3),e.NdJ("click",function(){return n.disconnectclick()}),e._UZ(4,"ion-icon",4),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6," FeatherWing "),e.qZA()()(),e.TgZ(7,"ion-content")(8,"ion-list"),e.YNc(9,L,15,9,"ng-container",5),e.qZA()()),2&t&&(e.Q6J("translucent",!1),e.xp6(9),e.Q6J("ngForOf",n.ble.sensors))},dependencies:[a.YG,a.Sm,a.hM,a.W2,a.jY,a.Gu,a.gu,a.Ie,a.Q$,a.q_,a.yh,a.B7,a.se,a.Nd,a.wd,a.sr,a.U5,a.QI,f.sg,f.O5,f.Nd,p.X$],styles:["ion-list-header[_ngcontent-%COMP%]{flex-direction:column;align-items:start;padding-top:20px}ion-list[_ngcontent-%COMP%]{padding-bottom:20px}.sensorname[_ngcontent-%COMP%]{font-weight:700}.seperateitems[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between}.updateintervalabel[_ngcontent-%COMP%]{font-size:medium}.attrgraphicon[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle}.attrname[_ngcontent-%COMP%]{font-size:medium;display:inline-block;vertical-align:middle}"]}),i})()}];let S=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[T.Bz.forChild(P),T.Bz]}),i})();function C(i){return new F.w(i,"./assets/i18n/",".json")}let Q=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[a.Pc,f.ez,m.u5,S,p.aw.forChild({loader:{provide:p.Zw,useFactory:C,deps:[x.eN]}})]}),i})()}}]);